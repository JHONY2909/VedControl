<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Nueva AtenciÃ³n</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <form [formGroup]="form" (ngSubmit)="guardar()">

    <!-- Foto -->
    <ion-card>
      <ion-card-content class="ion-text-center">
        
        <ion-img 
          *ngIf="foto; else placeholder" 
          [src]="foto"
          style="height: 220px; object-fit: cover; border-radius: 12px;">
        </ion-img>

        <ng-template #placeholder>
          <div style="height: 220px; background: #f4f5f8; border-radius: 12px; 
                      display: flex; align-items: center; justify-content: center;">
            <ion-icon name="camera-outline" size="large" color="medium"></ion-icon>
          </div>
        </ng-template>

        <div class="ion-text-center ion-margin-top">
          <ion-button fill="outline" (click)="tomarFoto()" class="ion-margin-end">
            <ion-icon slot="start" name="camera-outline"></ion-icon>
            Tomar foto
          </ion-button>
          
          <ion-button fill="outline" (click)="seleccionarFoto()" class="ion-margin-start">
            <ion-icon slot="start" name="images-outline"></ion-icon>
            Seleccionar
          </ion-button>
        </div>

        <!-- Indicador del mÃ©todo disponible -->
        <div class="ion-text-center ion-margin-top" style="font-size: 0.85em; color: var(--ion-color-medium);">
          <ion-text *ngIf="isRunningInApp(); else webMethod">
            ðŸ“± App nativa: Ambos mÃ©todos disponibles
          </ion-text>
          <ng-template #webMethod>
            <ion-text>
              
            </ion-text>
          </ng-template>
        </div>
        
        <input #fileInput type="file" accept="image/*" style="display: none;" 
               (change)="onFileSelected($event)">

      </ion-card-content>
    </ion-card>

    <!-- Formulario -->
    <ion-item>
      <ion-label position="stacked">Paciente <ion-text color="danger">*</ion-text></ion-label>
      <ion-input formControlName="paciente" placeholder="Nombre de la mascota"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Especie <ion-text color="danger">*</ion-text></ion-label>
      <ion-select formControlName="especie" placeholder="Seleccionar">
        <ion-select-option value="Perro">Perro</ion-select-option>
        <ion-select-option value="Gato">Gato</ion-select-option>
        <ion-select-option value="Ave">Ave</ion-select-option>
        <ion-select-option value="Roedor">Roedor</ion-select-option>
        <ion-select-option value="Reptil">Reptil</ion-select-option>
        <ion-select-option value="Otro">Otro</ion-select-option>
      </ion-select>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Raza (opcional)</ion-label>
      <ion-input formControlName="raza"></ion-input>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Motivo de consulta <ion-text color="danger">*</ion-text></ion-label>
      <ion-textarea formControlName="motivo" rows="3"></ion-textarea>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">DiagnÃ³stico</ion-label>
      <ion-textarea formControlName="diagnostico" rows="3"></ion-textarea>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Tratamiento indicado</ion-label>
      <ion-textarea formControlName="tratamiento" rows="3"></ion-textarea>
    </ion-item>

    <ion-item>
      <ion-label position="stacked">Importe $ <ion-text color="danger">*</ion-text></ion-label>
      <ion-input type="number" formControlName="importe"></ion-input>
    </ion-item>

    <ion-item lines="none">
      <ion-label>Â¿Recordatorio de vacuna en 30 dÃ­as?</ion-label>
      <ion-checkbox formControlName="proximaVacuna"></ion-checkbox>
    </ion-item>

    <ion-button 
      expand="block" 
      type="submit" 
      size="large"
      class="guardando ion-margin-top">
      
      <ion-spinner *ngIf="guardando"></ion-spinner>
      {{ guardando ? 'Guardando...' : 'Guardar AtenciÃ³n' }}

    </ion-button>

  </form>

</ion-content>
